<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Torre de Hanoi - Manual até 64 discos</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Roboto:wght@400;700&display=swap');

        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: 'Roboto', Arial, sans-serif;
          background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
          color: #eee;
          min-height: 100vh;
          padding: 30px 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
          user-select: none;
          text-align: center;
        }

        body::before {
          content: '';
          position: fixed;
          top: -40%;
          left: -40%;
          width: 180%;
          height: 180%;
          background: radial-gradient(circle at center, #00ffff22, transparent 70%);
          animation: pulse 6s infinite;
          pointer-events: none;
          filter: blur(90px);
          z-index: 0;
        }
        @keyframes pulse {
          0%, 100% { transform: rotate(0deg) scale(1); }
          50% { transform: rotate(180deg) scale(1.1); }
        }

        h1 {
          font-family: 'Orbitron', sans-serif;
          font-weight: 500;
          font-size: 3rem;
          color: #00ffff;
          text-shadow:
            0 0 10px #00ffff,
            0 0 30px #00ffff;
          margin-bottom: 30px;
          z-index: 1;
          position: relative;
          letter-spacing: 3px;
        }

        #controls {
          margin-bottom: 25px;
          z-index: 1;
          position: relative;
          display: flex;
          align-items: center;
          gap: 12px;
          flex-wrap: wrap;
          justify-content: center;
        }

        label {
          font-weight: 600;
          color: #00ffffcc;
          font-size: 1.1rem;
          user-select: none;
        }

        input[type=number] {
          width: 80px;
          font-size: 1.1rem;
          padding: 8px 12px;
          border-radius: 10px;
          border: none;
          outline: none;
          background: #00ffff22;
          color: #eee;
          box-shadow: inset 0 0 8px #00ffff88;
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        input[type=number]:focus {
          background: #00ffff55;
          box-shadow:
            inset 0 0 12px #00ffffcc,
            0 0 8px #00ffffaa;
          color: #000;
        }

        button#btn-start, button#btn-rank {
          background: linear-gradient(90deg, #00ffff, #00bfbf);
          border: none;
          padding: 14px 28px;
          font-size: 1.2rem;
          font-weight: 700;
          color: #011;
          border-radius: 15px;
          cursor: pointer;
          box-shadow:
            0 6px 15px #00ffffcc,
            inset 0 3px 8px #00bfbfcc;
          transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.15s ease;
          user-select: none;
          text-shadow: 0 0 6px #003333;
          margin-top: 15px;
          min-width: 140px;
          position: relative;
          z-index: 1;
        }
        button#btn-start:hover, button#btn-rank:hover {
          background: linear-gradient(90deg, #00bfbf, #00ffff);
          box-shadow:
            0 8px 25px #00ffffee,
            inset 0 4px 10px #00ffffee;
          transform: translateY(-3px);
          color: #000;
          text-shadow: none;
        }
        button#btn-start:active, button#btn-rank:active {
          transform: translateY(1px);
          box-shadow: inset 0 4px 7px #009999;
          color: #002222;
        }

        #towers-container {
          display: flex;
          justify-content: center;
          gap: 25px;
          width: 100%;
          max-width: 600px;
          position: relative;
          z-index: 1;
          user-select: none;
        }

        .tower {
          background: #111827;
          border-radius: 20px;
          width: 140px;
          height: 350px;
          padding: 15px 0;
          display: flex;
          flex-direction: column-reverse;
          align-items: center;
          cursor: pointer;
          overflow-y: auto;
          box-shadow:
            inset 0 0 10px #00ffff66,
            0 0 12px #00ffffaa;
          transition: box-shadow 0.3s ease;
          user-select: none;
        }
        .tower:hover {
          box-shadow:
            inset 0 0 15px #00ffffcc,
            0 0 22px #00ffffee;
        }
        .tower.selected {
          border: 3px solid #00ffff;
          box-shadow:
            inset 0 0 18px #00ffffcc,
            0 0 28px #00ffffff;
        }

        .disk {
          height: 18px;
          margin-bottom: 5px;
          border-radius: 8px;
          background-color: #00ffff;
          color: #011;
          font-weight: 700;
          font-family: 'Orbitron', sans-serif;
          text-align: center;
          line-height: 18px;
          white-space: nowrap;
          overflow: hidden;
          box-shadow:
            0 0 8px #00ffffaa,
            inset 0 0 8px #00bfbfcc;
          user-select: none;
          transition: background-color 0.3s ease;
        }
        .disk:nth-child(even) {
          background-color: #3200fc;
          color: white;
          box-shadow:
            0 0 10px #3200fccc,
            inset 0 0 10px #4b00ffcc;
        }
    </style>
</head>
<body>

<h1>Torre de Hanoi - Modo Manual</h1>
<div id="controls">
    <label for="n-discs-input">Número de discos (1 a 64): </label>
    <input id="n-discs-input" type="number" min="1" max="64" value="5" />
    <button id="btn-start">Iniciar</button>
</div>

<div id="towers-container">
    <div class="tower" data-index="0" title="Torre 1"></div>
    <div class="tower" data-index="1" title="Torre 2"></div>
    <div class="tower" data-index="2" title="Torre 3"></div>
</div>

<button id="btn-rank" type="button">Menu</button>
<script>
    (function verificarAutenticacao() {
  const token = localStorage.getItem('access_token');
  if (!token) {
    alert('Você não está autenticado!');
    window.location.href = 'index.html';
  }
})();
  document.getElementById('btn-rank').addEventListener('click', () => {
     window.location.href = 'http://localhost:8080/menu.html';
 });

 const towerEls = [...document.querySelectorAll('.tower')];
 const inputN = document.getElementById('n-discs-input');
 const btnStart = document.getElementById('btn-start');

 let towers = [[], [], []];
 let selectedTowerIndex = null;
 let nDisks = 5;
 let moveCount = 0;
 let startTime = null;
 let endTime = null;

 function getDiskWidth(size) {
   const maxWidth = 130;
   const minWidth = 20;
   if (nDisks <= 1) return maxWidth;
   const step = (maxWidth - minWidth) / (nDisks - 1);
   return minWidth + (size - 1) * step;
 }

 function render() {
   towerEls.forEach((towerEl, idx) => {
     towerEl.innerHTML = '';
     towers[idx].forEach(diskSize => {
       const disk = document.createElement('div');
       disk.className = 'disk';
       disk.style.width = getDiskWidth(diskSize) + 'px';
       disk.textContent = diskSize;
       towerEl.appendChild(disk);
     });
     if (idx === selectedTowerIndex) {
       towerEl.classList.add('selected');
     } else {
       towerEl.classList.remove('selected');
     }
   });
 }

 function canMove(fromIdx, toIdx) {
   if (towers[fromIdx].length === 0) return false;
   const movingDisk = towers[fromIdx][towers[fromIdx].length - 1];
   const destTower = towers[toIdx];
   if (destTower.length === 0) return true;
   const topDiskDest = destTower[destTower.length - 1];
   return movingDisk < topDiskDest;
 }

 function moveDisk(fromIdx, toIdx) {
   if (!canMove(fromIdx, toIdx)) {
     alert('Movimento inválido: disco maior não pode ficar sobre disco menor!');
     return false;
   }
   const disk = towers[fromIdx].pop();
   towers[toIdx].push(disk);
   moveCount++;
   return true;
 }

 towerEls.forEach((towerEl, idx) => {
   towerEl.addEventListener('click', () => {
     if (selectedTowerIndex === null) {
       if (towers[idx].length === 0) {
         alert('Esta torre não tem discos para mover.');
         return;
       }
       selectedTowerIndex = idx;
     } else {
       if (selectedTowerIndex !== idx) {
         if (moveDisk(selectedTowerIndex, idx)) {
           if (towers[2].length === nDisks) {
             endTime = new Date().toISOString();
             alert('Parabéns! Você completou a Torre de Hanoi! Salvando seu score...');
             saveScore();
           }
         }
       }
       selectedTowerIndex = null;
     }
     render();
   });
 });

 btnStart.addEventListener('click', () => {
   let val = parseInt(inputN.value, 10);
   if (isNaN(val) || val < 1 || val > 64) {
     alert('Por favor, insira um número entre 1 e 64.');
     return;
   }
   nDisks = val;
   towers = [[], [], []];
   for(let i = nDisks; i >= 1; i--) {
     towers[0].push(i);
   }
   selectedTowerIndex = null;
   moveCount = 0;
   startTime = new Date().toISOString();
   endTime = null;
   render();
 });

 function saveScore() {
   const scoreData = {
     nDisks: nDisks,
     movesMade: moveCount,
     begin: startTime,
     end: endTime
   };

   const token = localStorage.getItem('access_token');

   fetch('/scores', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'Authorization': `Bearer ${token}`
     },
     body: JSON.stringify(scoreData)
   })
   .then(response => {
     if (response.ok) {
       alert('Score salvo com sucesso!');
     } else {
       alert('Falha ao salvar o score.');
     }
   })
   .catch(() => {
     alert('Erro na comunicação com o servidor.');
   });
 }

 btnStart.click();
</script>

</body>
</html>
